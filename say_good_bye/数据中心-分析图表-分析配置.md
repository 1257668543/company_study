**需求wiki：**[分析图表-分析配置](https://wiki.corp.bianlifeng.com/pages/viewpage.action?pageId=639042227)

# 业务流程

```mermaid
graph TD
A[进入图表分析页面]-->B(加载初始维度/指标)
B-->C(携带初始 指标/维度 请求表格数据-初始化)
C-->D(用户点击左侧 维度/指标)
D-->E(右侧抽屉弹出, 用户填写配置信息)
E-->H(保存配置信息)
H-->F(收起抽屉, 点击右上角执行-请求新数据)
F-->G[表格渲染]
```

# 对应代码片段(本次需求改动相关)——表格

| 需求实现需要的   组件/函数/属性        | 相关位置                                                     | 描述                                                         |
| :------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| 请求表格数据接口: analysis/slice/query | component/Slice/store 函数：**fetchDataWithCache(data)**     | 携带配置信息**options**发起请求                              |
| 配置信息存储位置                       | component/Slice/store 属性：**options**(通过构造器传入)      | Views/analysis/Edit/store/属性：**sliceDetail** -> 同目录index属性：**params** ->  SliceItem属性：**options** -> component/Slice属性：**options** -> 通过实例化同目录store传入**options** |
| ==右侧抽屉组件==                       | views/analysis/Edit/AsideForm/index                          | renderFields() -> 通过 **props**传入的**type **判断点击的维度/指标类型 |
| **type**                               | views/analysis/Edit/LeftBottom下CompareGroupBys与Filters**静态**写入FieldsContainer/index.js | FieldsContainer/index 函数：**onClickItem(type,  index, key, item)** -> CompareGroupBys / Filters 函数：**onClickItem()** ->   leftBottom/index函数：**onClickItem()** -> analysis/Edit/index函数：**onClickitem()** -> 同目录store函数：**onClickitem()** { 整理参数创建包含**type**的对象**clickItem** } -> analysis/Edit/index从store属性：**clickItem**中解构出**type**传入Edit/AsideForm/index：<AsideForm **type**/> |
| 修改配置信息回调                       | views/analysis/Edit/store.js **函数：**setAttribute(type, index, value, attribute) -> index.js -> <AsideForm setAttribe/> | **type：**判断类型<br />**index：**对应左侧列表下标<br />**value：**修改的值<br />**attribute：**对应配置的属性名 |
| 动态渲染配置项                         | views/analysis/Edit/AsideForm/FormItem.js**组件：**FormItem(label, name, initialValue, rules, type, getFieldDecorator, onChange, data, children, ...props) | **Label:** 表单项显示的文本<br />**name:**  未知<br />**initialValue:** getFieldDecorator(initialValue)?<br />**rules: **校验规则<br />**Type：**需要展示的表单项类型<br />**onChange：**表单项值变化回调<br />**Children：**需要展示在表单项下方的JSX元素 |



# 功能模块图

```mermaid
graph TD
des(type) --> des2(secondType)
Time --> timeRange
Time --> time
A[Dim]
B[Metric]
Filter --> dimFilter
Filter --> otherFilter
CustomFilter
Sort --> dimSort
Sort --> otherSort
MonitorMetric


```

```mermaid
classDiagram
class 取数范围 {
	+ store.currentCycle
	+ store.selectedObj
	+ 修改store中取数范围数据的方法()
	+ 为自定义时getCycleTime()
}
class 时间 {
	+ setAttribute()
	+ getTime()
	+ getAnotherTime()
}
class Time {
	+ type
	+ secondType
	+ store.currentCycle
	+ store.selectedObj
	+ setAttribute()
	+ 修改store中取数范围数据的方法()
	+ 为自定义时getCycleTime()
	+ getTime()
	+ getAnotherTime()
}
时间 <|-- Time
取数范围 <|-- Time
class AsideForm {
	+ type
	+ secondType
	+ store.currentCycle
	+ store.selectedObj
	+ setAttribute()
	+ 修改store中取数范围数据的方法()
	+ 为自定义时getCycleTime()
	+ getTime()
	+ getAnotherTime()
}
Time <|-- AsideForm
```

# 维度/对比（宽度与对齐方式）——数据流向

```mermaid
graph TD
A[views/Edit/store: group_bys/metrics]-->B(views/Edit/sliceItem)
B-->C(component/Slice/index)
C-->D(component/Slice/table)
D-->E(component/Slice/TableView/Tr)
D-->F(component/Slice/table/thead)
E-->G(component/Slice/TableView/DrillTable/AddItem)

```

